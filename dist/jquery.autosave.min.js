var Autosave=Autosave||{};Autosave.storageName="autosave",Autosave.onPage=!1,Autosave._setItem=function(e){var t=Autosave._getFullItem(),a=$(e).closest("form").attr("data-autosave"),o=$(e).index(),s=!1,u=e.value;$.each(t,function(e,t){t.id==a&&t.i==o&&(t.text=u,t.reset=!1,s=!0)}),s||t.push({id:a,i:o,text:u,reset:!1}),Autosave.onPage=""!=u,window.localStorage.setItem(Autosave.storageName,JSON.stringify(t))},Autosave._getFullItem=function(){return JSON.parse(window.localStorage.getItem(Autosave.storageName))||[]},Autosave._getText=function(e,t){var a=$(e).closest("form").attr("data-autosave"),o=$(e).index(),s="";return $.each(Autosave._getFullItem(),function(e,u){if(u.id==a&&u.i==o&&(t&&0==u.reset||!t))return void(s=u.text)}),s},Autosave.bind=function(e){if(90==e.keyCode&&e.ctrlKey){if(""!=this.value)return!0;this.value=Autosave._getText(this,!1),Autosave._setItem(this)}else e.ctrlKey||Autosave._setItem(this)},Autosave.restore=function(){if(""==this.value){var e=Autosave._getText(this,!0);this.value=e,Autosave.onPage=""!=e}},Autosave.reset=function(){var e=Autosave._getFullItem(),t=$(this).closest("form").attr("data-autosave");$.each(e,function(e,a){a.id==t&&(a.reset=!0,Autosave.onPage=!1)}),window.localStorage.setItem(Autosave.storageName,JSON.stringify(e))},Autosave.remove=function(e){var t=Autosave._getFullItem(),a=$(e).attr("data-autosave");$.each(t,function(e,o){if(o.id==a){var s=t.indexOf(o);s>-1&&t.splice(s,1),Autosave.onPage=!1}}),window.localStorage.setItem(Autosave.storageName,JSON.stringify(t))},$(document).on("keyup",".autosave-form textarea",Autosave.bind),$(document).on("reset",".autosave-form",Autosave.reset),$(function(){$(".autosave-form textarea").each(Autosave.restore)}),$(window).on("beforeunload",function(){if(Autosave.onPage)return"Возможно, внесенные изменения не сохранятся."});